<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<meta content="email=no" name="format-detection" />
		<script type="text/javascript" src="js/global.js"></script>
		<script type="text/javascript" src="js/mui.min.js"></script>
		<link rel="stylesheet" href="css/mui.min.css" />
		<link rel="stylesheet" href="css/app.css" />
		<link rel="stylesheet" href="css/match.css" />

		<title>微软装</title>
	</head>
	<style>
		#c {
			position: absolute;
			top: 50%;
			left: 50%;
			margin: -100px;
		}
		
		.note {
			position: absolute;
			top: 50%;
			margin-top: 130px;
			text-align: center;
			width: 100%;
			font-size: 12px;
			color: #9e9e9e;
		}
	</style>

	<body class="background-gray">
		<canvas id=c></canvas>
		<div class="note">正在根据您的情况与喜好进行智能搭配...</div>

	</body>
	<script>
		var w = c.width =
			h = c.height = 200,
			ctx = c.getContext('2d'),
			total = 20,
			particlesParRow = 10,
			minValue = 30,
			updatesBeforeStart = 500,
			repaintColor = 'rgba(235, 235, 235, 0.1)',
			templateColor = 'hsl(hue, 80%, 50%)',
			particles = [],
			colors = [],
			radiants = [],
			colorPart = 360 / total,
			radiantPart = Math.PI * 2 / total,
			alphaValue = true;
		for (var i = 0; i < total; ++i) {
			var array = [];
			particles.push(array);
			colors.push(templateColor.replace('hue', colorPart * i));
			radiants.push(radiantPart * i);
			for (var j = 0; j < particlesParRow; ++j) {
				array.push(i * minValue);
			}
		}
		for (var i = 0; i < updatesBeforeStart; ++i) update();

		function anim() {
			window.requestAnimationFrame(anim);
			ctx.fillStyle = repaintColor;
			ctx.beginPath();
			ctx.arc(w / 2, h / 2, w / 2 + 1, 0, Math.PI * 2);
			ctx.fill();
			ctx.closePath();
			ctx.translate(w / 2, h / 2);
			ctx.rotate(.006);
			ctx.translate(-w / 2, -h / 2);
			for (var i = 0; i < total; ++i) {
				ctx.fillStyle = colors[i];
				for (var j = 0; j < particlesParRow; ++j) {
					var particle = particles[i][j];
					particles[i][j] -= particle / 70;
					ctx.beginPath();
					ctx.arc(w / 2, h / 2, particle, radiants[i], radiants[i] + radiantPart);
					ctx.arc(w / 2, h / 2, particles[i][j], radiants[i] + radiantPart, radiants[i], true);
					ctx.closePath();
					ctx.fill();
					if (particles[i][j] <= minValue && Math.random() < .1) {
						particles[i][j] = w / 2;
					}
				}
			}
		}
		anim();

		function update() {
			for (var i = 0; i < total; ++i) {
				for (var j = 0; j < particlesParRow; ++j) {
					var particle = particles[i][j];
					particles[i][j] -= particle / 70;
					if (particles[i][j] <= minValue && Math.random() < .1) {
						particles[i][j] = w / 2;
					}
				}
			}
		}
		mui.ready(function() {
			var timestamp = parseInt(new Date().getTime() / 1000);
			IC_data();
		});
console.log(localStorage.IC)
		function IC_data() {
			data = localStorage.IC;
			localStorage.removeItem("IC");
			mui.ajax(apiurl + 'schemes/match', {
				data: {
					'tags': data
				},
				dataType: 'json',
				type: 'post',
				timeout: 6000,
				success: function(data) {
					if (data.success == true) {
						localStorage.schemes = JSON.stringify(data.data);
						console.log(JSON.stringify(data.data))
						setTimeout(function() {
							location.href = "index.html?IntelligentCollocation"
						}, 3000);
					} else {
						mui.alert("获取方案失败，请稍候再试");
					}
				},
				error: function(xhr, textStatus, errorThrown) {
					mui.alert("网络连接失败，请稍候再试");
				}
			});
		}
	</script>

</html>