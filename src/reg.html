<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<meta content="email=no" name="format-detection" />
		<link href="css/register.css" type="text/css" rel="stylesheet">
		<link rel="stylesheet" href="css/app.css" />
		<title>微软装</title>
	</head>

	<body>
		<div id="load">
			<div class="loading"></div>
			<div class="loading-text"><img src="images/load.gif" width="25px">加载中，请稍候...</div>
		</div>

		<div id="layout">
			<span></span>

			<ul>
				<p id="err_msg"></p>
				<li><i class="un"><img src="images/user_name.png"></i><input id="phonenumber" class="username" type="text" placeholder="请输入手机号" /></li>
				<li><i class="yz"><img src="images/msg.png"></i><input id="verify" class="yzm" type="text" placeholder="请输入手机验证码" /><input type="button" id="send" value="获取验证码" /></li>
				<li><i class="pw"><img src="images/pwd.png"></i><input id="password" class="pwd" type="password" placeholder="请输入密码" /></li>
			</ul>
			<div class="reg_btn">
				<button class="submit" type="submit" onclick="reg()">注册</button>
				<a href="login.html">
					<div class="reg-login">
						<p>已有帐号，立即登陆</p>
					</div>
				</a>
			</div>

		</div>

	</body>
	<script src="js/app.js"></script>
	<script src="js/global.js"></script>
	<script src="js/mui.js"></script>
	<script src="js/register.js"></script>
	<script>
		"use strict";
		stopload();
		var verifynum = 0;
		localStorage.removeItem("userinfo");
		localStorage.removeItem("alladdress");
		localStorage.removeItem("collectpic");

		function reg() {
			var reg = /^0?1[3|4|5|8][0-9]\d{8}$/;
			let mobile = document.getElementById("phonenumber").value;
			//			verify = document.getElementById("verify").value;
			//			email =  document.getElementById("mailaccount").value;
			let password = document.getElementById("password").value;
			if (!reg.test(mobile)) {
				alert("请输入正确的手机号码");
				return false;
			};
			//			if(!verify){
			//				alert("请输入您收到的验证码");
			//				return false;
			//			}
			//			if(verify !== verifynum){
			//				alert("验证码错误,请确认");
			//				return false;
			//			}
			if (!password) {
				alert("请输入密码");
				return false;
			}
			startload();
			mui.ajax(apiurl + 'users/signup', {
				data: {
					'SignupForm[mobile]': mobile,
					'SignupForm[password]': password
				},
				dataType: 'json',
				type: 'post',
				timeout: 6000,
				success: function(data) {
					if (data.success == true) {
						localStorage.userinfo = JSON.stringify(data.data);
						localStorage.cart = '{"goods":[]}';
						var alladdress = {
							"selected": null,
							"address": []
						}
						localStorage.alladdress = JSON.stringify(alladdress);
						window.location.href = 'index.html';
					} else {
						alert(data.message);
						stopload();
					}
				},
				error: function(xhr, type, errorThrown, message) {
					alert("网络连接失败，请稍候再试");
					stopload();
				}
			});
		}
	</script>

</html>