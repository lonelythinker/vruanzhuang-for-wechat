<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<meta content="email=no" name="format-detection" />
		<link rel="stylesheet" href="css/mui.min.css" />
		<link rel="stylesheet" href="css/app.css" />
		<title>微软装</title>
	</head>
	<style>
		.mui-input-row.mui-search .mui-icon-clear {
			top: 10px!important;
		}
		
		.mui-search:before {
			top: 10px;
		}
		
		.mui-search {
			color: #000!important;
		}
		
		.mui-search .mui-placeholder {
			line-height: 39px;
		}
		
		body {
			background-color: #bbb;
		}
		
		.mui-grid-view.mui-grid-9 {
			background-color: #bbb;
		}
	</style>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title"><div class="mui-input-row mui-search">
					<input type="search" class="mui-input-clear" placeholder="搜索" onkeypress="Search()">
				</div></h1>
		</header>

		<div class="mui-content">
			<div class="mui-slider-item">
				<ul class="mui-table-view mui-grid-view mui-grid-9" id="class">
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" v-for="item in items[0].children">
						<span class="class" data-id="{{item.id}}" root-id="{{item.root}}" name="{{item.name}}">
							<img v-bind:src="item.name|iconurl 'images/icon/' 'png'" width="100%" height="100%">
							<div class="mui-media-body" class="name">{{item.name}}</div>
						</span>
					</li>
				</ul>
			</div>
		</div>
	</body>
	<script src="js/global.js"></script>
	<script src="js/mui.min.js"></script>
	<script src="js/vue.js"></script>
	<script>
	use strict;
		mui.init();
		var url = window.location.search;
		var nSpaceSortId = url.substring(url.lastIndexOf('=') + 1, url.length);
		Vue.filter('iconurl', function(value, url, format) {
			return url + value + "." + format;
		})
		mui.ajax(apiurl + 'tags/multi-children?name=产品分类', {
			dataType: 'json',
			type: 'get',
			timeout: 6000,
			success: function(data) {
				if (data.success == true) {
					new Vue({
						el: '#class',
						data: data.data,
						compiled: function() {
							mui('#class').on('tap', '.class', function() {
								nClassId = this.getAttribute('data-id');
								mui.ajax(apiurl + 'product-tags?filter=tag_id:' + nClassId + '&expand=product&per-page=30', {
									dataType: 'json',
									type: 'get',
									timeout: 6000,
									success: function(data) {
										data.success == true ? (!data.data.items.length ? mui.alert("本类暂无单品", "微软装") : (localStorage.tempproduct = JSON.stringify(data.data), location.href = "productlist.html?spacesortid=" + nSpaceSortId + "&classid=" + nClassId)) : mui.alert("获取方案失败，请稍候再试");
									},
									error: function(xhr, textStatus, errorThrown) {
										mui.alert("网络连接失败，请稍候再试","微软装");
									}
								});
								return;
							});
						}
					})
				} else {
					mui.alert("获取标签失败，请稍候再试","微软装");
					stopload();
				}
			},
			error: function(xhr, textStatus, errorThrown) {
				mui.alert("网络连接失败，请稍候再试","微软装");
				stopload();
			}
		});

		function Search() {
			if (event.keyCode == 13) {
				mui.ajax(apiurl + 'products?lfilter=name:' + (localStorage.filter = document.getElementsByTagName("input")[0].value) + "&per-page=30", {
					dataType: 'json',
					type: 'get',
					timeout: 6000,
					success: function(data) {
						data.success == true ? (!data.data.items.length ? mui.alert("没有找到符合条件的单品!", "微软装") : (localStorage.tempproduct = JSON.stringify(data.data), location.href = "productlist.html?spacesortid=" + nSpaceSortId + "&lfilter=1")) : mui.alert("获取方案失败，请稍候再试");
					},
					error: function(xhr, textStatus, errorThrown) {
						mui.alert("网络连接失败，请稍候再试");
					}
				});
			}
		}
	</script>

</html>